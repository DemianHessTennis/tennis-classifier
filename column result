import streamlit as st
import pandas as pd
from io import StringIO

st.title("ğŸ¾ Tennis Straight/Decider Sets Classifier")

st.write("Collez vos donnÃ©es de matchs ci-dessous (colonnes : Date, Tournoi, Surface, Score, etc.)")

# Upload ou collage de donnÃ©es
uploaded_file = st.file_uploader("Choisir un fichier CSV", type=['csv'])
data_text = st.text_area("Ou coller directement vos donnÃ©es CSV", height=200)

if uploaded_file is not None:
    data = pd.read_csv(uploaded_file)
elif data_text:
    data = pd.read_csv(StringIO(data_text))
else:
    st.stop()

if 'score' in data.columns.str.lower():
    score_col = data.columns[data.columns.str.lower().str.contains('score')][0]
elif 'resultat' in data.columns.str.lower():
    score_col = data.columns[data.columns.str.lower().str.contains('resultat')][0]
else:
    st.error("Colonne 'score' ou 'rÃ©sultat' non trouvÃ©e. VÃ©rifiez vos donnÃ©es.")
    st.stop()

# Classifier
def classify_straight_decider(score_str):
    score_str = str(score_str).upper().strip()
    
    # DÃ©tecter straight sets (2-0, 3-0)
    if any(x in score_str for x in ['2-0', '3-0', '6-0', '6-1', '6-2', '6-3', '6-4']):
        return 0
    
    # DÃ©tecter decider sets (2-1, 3-1, 3-2)
    elif any(x in score_str for x in ['2-1', '3-1', '3-2']):
        return 1
    
    else:
        return -1  # Inconnu

# Appliquer la classification
data['Straight_Decider'] = data[score_col].apply(classify_straight_decider)

# Afficher les rÃ©sultats
st.subheader("ğŸ“Š RÃ©sultats de Classification")
st.dataframe(data[['score_col', 'Straight_Decider']], use_container_width=True)

# Statistiques
st.subheader("ğŸ“ˆ Statistiques")
col1, col2, col3 = st.columns(3)
with col1:
    st.metric("Total Matchs", len(data))
with col2:
    straight = len(data[data['Straight_Decider'] == 0])
    st.metric("Straight Sets", straight)
with col3:
    decider = len(data[data['Straight_Decider'] == 1])
    st.metric("Decider Sets", decider)

# Colonne Ã  copier
st.subheader("ğŸ“‹ Colonne Ã  Copier-Coller dans Excel")
copy_col = data['Straight_Decider'].astype(str)
st.text_area("Copiez cette colonne :", copy_col.to_csv(index=False, header=False), height=200)

# TÃ©lÃ©chargement
csv = data[['score_col', 'Straight_Decider']].to_csv(index=False)
st.download_button("ğŸ“¥ TÃ©lÃ©charger CSV", csv, "tennis_results.csv", "text/csv")

# Instructions
with st.expander("â„¹ï¸ Instructions"):
    st.write("""
    1. **Collez vos donnÃ©es** dans la zone de texte (format CSV)
    2. **VÃ©rifiez la colonne score** (doit contenir des scores comme "6-4 6-3" ou "6-4 4-6 6-3")
    3. **Copiez la colonne 'Straight_Decider'** dans votre Excel
    4. **0 = Straight Sets**, **1 = Decider Sets**
    """)
